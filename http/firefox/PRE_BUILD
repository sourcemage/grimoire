if  [  !  -f  /root/.cvspass  ];  then
  touch /root/.cvspass
fi                                                                          &&

mk_source_dir  $SOURCE_DIRECTORY                                            &&

FIREFOX_TARBALL=firefox-1.0+.tar.bz2  &&

if  [  "$FIREFOX_CVS"  =  "y"   ]              &&
    [  -f  $SOURCE_CACHE/$FIREFOX_TARBALL  ];  then
    message  "${MESSAGE_COLOR}Unpacking source file $FIREFOX_TARBALL"       \
             "$for ${SPELL_COLOR}$SPELL${DEFAULT_COLOR}"                    &&
    tar  jxf  $SOURCE_CACHE/$FIREFOX_TARBALL
else
  unpack_file  ''
fi                                                                          &&

#
#cvs updates anyone?
#
if  [  "$FIREFOX_CVS"  =  "y"  ];  then
  message  "${MESSAGE_COLOR}\tIt can take some considerable time to"        \
           "\tregenerate the cvs tags you will not see much progress or a"  \
           "\ttime but do not despair, GOOD THINGS are happening in the"    \
           "\tbackground.${DEFAULT_COLOR}"                                  &&
  cvs  -z9  -q  -d:pserver:anonymous@cvs-mirror.mozilla.org:/cvsroot        \
       checkout -PA  -d  mozilla mozilla/client.mk                          &&
  cd  $SOURCE_DIRECTORY                                                     &&
  if  [  "$FIREFOX_SVG"  =  "y"  ];  then
    make  -j1  -f  client.mk  checkout  MOZ_CO_FLAGS=-PA                    \
      MOZ_CO_PROJECT=browser  MOZ_CO_MODULE=mozilla/other-licenses/libart_lgpl
  else
    make  -j1  -f  client.mk  checkout  MOZ_CO_FLAGS=-PA  MOZ_CO_PROJECT=browser
  fi                                                                        &&
  cd  $BUILD_DIRECTORY                                                      &&
  message  "${MESSAGE_COLOR}Generating tarball for reuse"                   &&
  tar  jcf  $FIREFOX_TARBALL  mozilla/                                      &&
  message  "Moving $FIREFOX_TARBALL to/var/spool/sorcery${DEFAULT_COLOR}"   &&
  mv  -v  $FIREFOX_TARBALL  $SOURCE_CACHE/
fi                                                                          &&

cd  $SOURCE_DIRECTORY                                                       &&

# Patches for freetype 2.1.8 and gcc 3.4
patch  -p1  <  $SCRIPT_DIRECTORY/freetype.patch  &&
if use_gcc ^4; then
  patch  -p1  <  $SCRIPT_DIRECTORY/gcc4.patch
fi &&

# Typeaheadfind patch
patch -p0 < $SCRIPT_DIRECTORY/typeaheadfind.diff
