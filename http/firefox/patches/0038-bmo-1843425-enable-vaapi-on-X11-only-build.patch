
# HG changeset patch
# User stransky <stransky@redhat.com>
# Date 1689756118 0
# Node ID cc17b92d0327a30ffb9a863533c0bfe48e72acdf
# Parent  570c5180c6544a50abca263132c618e2f9180733
Bug 1843425 [Linux] Probe HW decoding on X11 too r=emilio

Differential Revision: https://phabricator.services.mozilla.com/D183858

diff --git a/widget/gtk/GfxInfo.cpp b/widget/gtk/GfxInfo.cpp
--- a/widget/gtk/GfxInfo.cpp
+++ b/widget/gtk/GfxInfo.cpp
@@ -1284,24 +1284,21 @@ nsresult GfxInfo::GetFeatureStatusImpl(
   auto ret = GfxInfoBase::GetFeatureStatusImpl(
       aFeature, aStatus, aSuggestedDriverVersion, aDriverInfo, aFailureId, &os);
 
   // Probe VA-API/V4L2 on supported devices only
   if (aFeature == nsIGfxInfo::FEATURE_HARDWARE_VIDEO_DECODING) {
     if (!StaticPrefs::media_hardware_video_decoding_enabled_AtStartup()) {
       return ret;
     }
-    bool probeHWDecode = false;
-#ifdef MOZ_WAYLAND
-    probeHWDecode =
+    bool probeHWDecode =
         mIsAccelerated &&
         (*aStatus == nsIGfxInfo::FEATURE_STATUS_OK ||
          StaticPrefs::media_hardware_video_decoding_force_enabled_AtStartup() ||
          StaticPrefs::media_ffmpeg_vaapi_enabled_AtStartup());
-#endif
     if (probeHWDecode) {
       GetDataVAAPI();
       GetDataV4L2();
     } else {
       mIsVAAPISupported = Some(false);
       mIsV4L2Supported = Some(false);
     }
     if (!mIsVAAPISupported.value() && !mIsV4L2Supported.value()) {

